---
title: 'MAEA: Problemas 1,2 y 3'
author: "Alberto Rincón Borreguero"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(dev = 'pdf', fig.align = 'center')
```


## Problema 1

Se clasificó a 177 personas casadas según su estatus de fumador, variable B, con valores de No Fumador, b1, Poco Fumador, b2, (< 6 cigarrillos/día), Fumador Moderado, b3 (≥ 6 y < 15 cigarrillos/día) y Gran Fumador, b4 (≥ 15 cigarrillos/día), y el de su pareja, variable A, con valores No Fumador, a1, Poco Fumador, a2 (< 6 cigarrillos/día), Fumador Moderado, a3 (≥ 6 y < 15 cigarrillos/día) y Gran Fumador, a4 (≥ 15 cigarrillos/día). Los resultados aparecen recogidos en la siguiente tabla:

```{r creacion dataset}
X           <- matrix(c(42,12,18,2,18,22,6,8,4,8,10,12,0,2,6,7), ncol = 4)
colnames(X) <- c("No Fumador","Poco Fumador","Fumador Moderado","Gran Fumador")
rownames(X) <- c("Pareja No fumadora","Pareja Poco Fumadora","Pareja Fumadora Moderada","Pareja Gran Fumadora")
X
```
Test de independencia de caracteres $\chi^2$ con hipótesis nula $h_0: Independecia\ entre\ las\ variables\ B\ y\ A.$

```{r chi square, warning=FALSE}
chi2 = chisq.test(X)
chi2
```
Dado que el p-valor es prácticamente cero, `r sprintf("%.10f",chi2$p.value)`, se rechaza la hipótesis nula de independecia entre ambas variables.

Se procede a realizar un análisis de correspondencias para comprobar si exista alguna relación entre los valores observados de las dos variables.

```{r fig.align='center'}
library(ca)
correspondencias <- ca(X)
plot(correspondencias)
```
El gráfico bi-dimensional obtenido establece que las personas entrevistadas que se declararon No Fumadoras o Poco Fumadoras tienen parejas con el mismo hábito. Por otra parte, cuando el entrevistado se declara como Fumador Moderado o Gran Fumador, su pareja, por lo general, es Gran Fumadora. Se aprecia que la observación de la variable A, Pareja Fumadora Moderada, no tiene una relación estrecha con ninguna observacion de la variable B, siendo Poco Fumador la más alejada de todas.

## Problema 2

```{r carga de datos}
injerto <- read.csv("datos/examen/injerto.txt", sep=" ")
head(injerto)
```
**(a)** Dado que las covariables a considerar en un modelo de regresión deben ser independientes, contrastar mediante un test de Spearman de independencia, si pueden considerarse independientes las covariables rcpage y donage.

```{r Spearman, warning=FALSE}
corr <- cor.test(injerto$rcpage, injerto$donage, method = 'spearman')
corr
```
El test de spearman se interpreta de la siguiente forma: Magnitudes de rho cercanas a 1 indican mayor correlación mientras que los valores cercanos a cero indican una menor correlación.
En este caso, el valor **0.72** indica que las variables rcpage y donage **no son independientes**.

**(b)** Analizar mediante una Regresión Logística qué variables son significativas para predecir la probabilidad p de presentar la enfermedad de Injerto contra Huésped, variable gvhd, de entre las 3 covariables siguientes: index, donage, preg.

```{r}
regression <- glm(gvhd~index+donage+preg, data = injerto, family = binomial(link = "logit"))
summary(regression)
```
Se observa que la variable $index$ con p-valor de $0.01$ es la más significativa en la predicción.

**(c)** Determinar la estimación de p en función de las variables que resulten significativas.

```{r}
regression <- glm(formula = gvhd ~ index, family = binomial(link = "logit"), data = injerto)
summary(regression)
```
(d) ¿Qué probabilidad de presentar la Enfermedad de injerto contra huésped tiene un individuo con índice reacciones de linfocitos igual a 2′5, cuyo donante que nunca ha estado embarazada y tiene una edad de 55 años?

```{r eval=TRUE}
probability <- predict.glm(object = regression, data.frame(index=2.5, preg=0 ,donage=55), type = "response")
```

La probabilidad de presentar la enfermedad es del **`r sprintf("%.2f",probability*100)`% **

## Problema 3

Se desea realizar una Regresiónn no Lineal ajustando una función tipo sigmoide a los siguientes pares de datos,

| x  | y  |
|:--:|:--:|
| 19 | 65 |
| 25 | 61 |
| 38 | 56 |
| 47 | 28 |
| 53 | 12 |
| 69 | 10 |

utilizando la correspondiente función de autoarranque. Determinar la función sigmoide ajustada.

```{r carga datos problema 3}
pb3.datos <- data.frame(x = c(19,25,38,47,53,69),
                        y = c(65,61,56,28,12,10))
```

```{r representación gráfica}
```



Sea la función sigmoide: $$\eta(x,\theta) = \theta_1 + \frac{\theta_2 - \theta_1 }{1 + e^{\theta_3(x - \theta_4)}} $$


Se realiza la regresión no lineal, con su correspondiente función de arranque SSfpl, en la siguiente linea.

```{r}
model <- nls(y~ SSfpl(-x,b1,b2,b3,b4), data=pb3.datos)
```

Obtenemos información acerca del modelo generado mediante la función summary.
```{r}
summary(model)
```
La suma de los errores residuales es muy pequeña, como se aprecia a continuación. Por tanto podemos decir que el modelo se ajusta adecuadamente a los datos.

```{r}
sum(resid(model))
```

Por último, mostramos el ajuste del modelo (linea azul) para los datos de la columna y del *dataframe*.

```{r}
plot(pb3.datos, pch=16)
lines(pb3.datos$x, predict(model), col='blue')
```



